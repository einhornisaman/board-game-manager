jQuery(document).ready(function($) {
    // Autocomplete for database search
    $('#db-game-search').autocomplete({
        source: function(request, response) {
            $.ajax({
                url: bgm_ajax.ajax_url,
                dataType: 'json',
                data: {
                    action: 'bgm_search_games',
                    term: request.term,
                    nonce: bgm_ajax.nonce
                },
                success: function(data) {
                    response($.map(data, function(item) {
                        return {
                            label: item.name,
                            value: item.name,
                            id: item.id
                        };
                    }));
                }
            });
        },
        minLength: 2,
        select: function(event, ui) {
            // Display selected game info
            $('#selected-game-name').text(ui.item.label);
            $('#delete-game-id').val(ui.item.id);
            $('#selected-game-info').show();
            
            return true;
        }
    });
    
    // Confirmation dialog
    $('#confirm-delete-btn').on('click', function() {
        var gameName = $('#selected-game-name').text();
        $('#confirm-game-name').text(gameName);
        
        // Initialize and open dialog
        $('#confirmation-dialog').dialog({
            resizable: false,
            height: 'auto',
            width: 400,
            modal: true,
            buttons: {
                Cancel: function() {
                    $(this).dialog('close');
                },
                'Delete': {
                    text: 'Delete',
                    class: 'button-primary delete-btn',
                    click: function() {
                        $('#delete-form').submit();
                        $(this).dialog('close');
                    }
                }
            }
        });
    });
});